 # APJ员工管理系统 - 前后端联调指南

## 📋 目录

1. [环境准备](#环境准备)
2. [后端启动](#后端启动)
3. [前端启动](#前端启动)
4. [联调测试](#联调测试)
5. [常见问题](#常见问题)

---

## 一、环境准备

### 1.1 必需软件

- **Node.js** >= 16.0.0
- **npm** >= 8.0.0 或 **yarn** >= 1.22.0
- **Java** >= 17
- **Maven** >= 3.8
- **PostgreSQL** >= 12

### 1.2 检查环境

```bash
# 检查Node.js版本
node -v

# 检查npm版本
npm -v

# 检查Java版本
java -version

# 检查Maven版本
mvn -v
```

---

## 二、后端启动

### 2.1 数据库准备

1. **创建数据库**
   ```sql
   CREATE DATABASE empmgmt;
   ```

2. **执行建表SQL**
   - 参考 `guide.md` 中的建表语句
   - 创建 `employee` 表
   - 创建 `user_account` 表
   - 创建相关函数（`fn_dept_emp_count`、`fn_dept_avg_salary`、`fn_emp_years`）

3. **配置数据库连接**
   - 修改 `src/main/resources/application.yml`
   - 确保数据库连接信息正确

### 2.2 启动后端服务

```bash
# 方式1：使用Maven
mvn spring-boot:run

# 方式2：使用IDE
# 运行 EmpMgmtApplication.java

# 方式3：打包后运行
mvn clean package
java -jar target/employ-management-0.0.1-SNAPSHOT.jar
```

### 2.3 验证后端启动

- 访问 `http://localhost:8080`
- 应该能看到Spring Boot默认页面或404（说明服务已启动）

### 2.4 后端CORS配置检查

确保 `SecurityConfig.java` 中已配置CORS：

```java
.cors(cors -> cors.configurationSource(corsConfigurationSource()))
```

如果还没有配置，参考之前的CORS配置方案。

---

## 三、前端启动

### 3.1 安装依赖

```bash
# 进入前端目录
cd frontend

# 安装依赖
npm install
```

### 3.2 启动开发服务器

```bash
npm run dev
```

前端将在 `http://localhost:3000` 启动。

### 3.3 验证前端启动

- 浏览器访问 `http://localhost:3000`
- 应该能看到登录页面

---

## 四、联调测试

### 4.1 测试流程

#### 步骤1：用户注册/登录

1. 访问 `http://localhost:3000`
2. 点击"还没有账号？立即注册"
3. 填写注册信息：
   - 用户名：`admin`
   - 密码：`admin123`（至少6位）
   - 邮箱：`admin@example.com`（可选）
4. 点击"注册"
5. 注册成功后自动登录并跳转到员工列表页

#### 步骤2：员工管理功能测试

1. **查看员工列表**
   - 登录后自动跳转到员工列表
   - 查看现有员工数据

2. **新增员工**
   - 点击"新增员工"按钮
   - 填写员工信息：
     - 姓名：必填
     - 部门：必填
     - 入职日期：必填
     - 薪资：必填
     - 其他字段可选
   - 点击"创建"
   - 验证是否成功添加到列表

3. **搜索员工**
   - 在搜索框输入员工姓名
   - 点击搜索按钮
   - 验证搜索结果

4. **编辑员工**
   - 点击员工列表中的"编辑"按钮
   - 修改员工信息
   - 点击"更新"
   - 验证修改是否生效

5. **删除员工**
   - 点击员工列表中的"删除"按钮
   - 确认删除
   - 验证员工是否从列表中移除

#### 步骤3：统计功能测试

1. 点击侧边栏"数据统计"
2. 查看各部门员工数量统计
3. 查看各部门平均薪资统计
4. 验证统计数据是否正确

### 4.2 API测试清单

使用Postman或浏览器开发者工具测试以下接口：

- [ ] `POST /api/auth/register` - 注册
- [ ] `POST /api/auth/login` - 登录
- [ ] `GET /api/employ` - 获取员工列表
- [ ] `GET /api/employ/{id}` - 获取员工详情
- [ ] `POST /api/employ` - 创建员工
- [ ] `PUT /api/employ/{id}` - 更新员工
- [ ] `DELETE /api/employ/{id}` - 删除员工
- [ ] `GET /api/employ/stats/dept-count` - 部门人数统计
- [ ] `GET /api/employ/stats/dept-avg-salary` - 部门平均薪资统计

---

## 五、常见问题

### 5.1 跨域问题（CORS）

**问题现象：**
```
Access to fetch at 'http://localhost:8080/api/auth/login' from origin 'http://localhost:3000' 
has been blocked by CORS policy
```

**解决方案：**

1. **检查后端CORS配置**
   - 确保 `SecurityConfig.java` 中配置了CORS
   - 参考之前的CORS配置方案

2. **使用Vite代理（推荐）**
   - 前端已配置Vite代理（`vite.config.ts`）
   - 确保后端服务运行在 `http://localhost:8080`

### 5.2 Token相关问题

**问题1：登录后Token未保存**

- 检查浏览器控制台是否有错误
- 检查 `localStorage` 中是否有 `token` 和 `auth-storage`

**问题2：Token过期**

- Token过期会自动跳转到登录页
- 重新登录即可

**问题3：401未授权错误**

- 检查Token是否正确添加到请求头
- 检查后端JWT配置是否正确
- 检查Token是否过期

### 5.3 接口调用失败

**问题现象：**
- 网络错误
- 404 Not Found
- 500 Internal Server Error

**排查步骤：**

1. **检查后端服务**
   ```bash
   # 检查后端是否运行
   curl http://localhost:8080/api/auth/login
   ```

2. **检查网络连接**
   - 打开浏览器开发者工具（F12）
   - 查看Network标签
   - 检查请求URL和响应状态

3. **检查请求参数**
   - 查看请求体是否正确
   - 查看请求头是否包含Token

4. **查看后端日志**
   - 检查后端控制台错误信息
   - 检查数据库连接是否正常

### 5.4 页面空白或加载失败

**问题1：依赖未安装**
```bash
cd frontend
npm install
```

**问题2：端口被占用**
- 修改 `vite.config.ts` 中的端口号
- 或关闭占用端口的程序

**问题3：构建错误**
```bash
# 清理缓存重新安装
rm -rf node_modules package-lock.json
npm install
```

### 5.5 数据格式问题

**问题：日期格式不匹配**

- 前端使用 `dayjs` 处理日期
- 后端返回的日期格式为 `YYYY-MM-DD`
- 确保日期字段正确格式化

**问题：数字精度问题**

- 薪资字段使用 `BigDecimal`，前端接收为 `number`
- 确保数字格式化正确

---

## 六、调试技巧

### 6.1 浏览器开发者工具

1. **Console标签**
   - 查看JavaScript错误
   - 查看API调用日志

2. **Network标签**
   - 查看API请求和响应
   - 检查请求头、请求体、响应数据

3. **Application标签**
   - 查看 `localStorage` 中的Token
   - 查看 `sessionStorage`

### 6.2 后端日志

- 查看控制台输出的SQL语句
- 查看异常堆栈信息
- 检查Spring Security日志

### 6.3 前后端联调

1. **使用Postman测试后端接口**
   - 先确保后端接口正常
   - 再测试前端调用

2. **使用浏览器测试前端**
   - 打开开发者工具
   - 查看网络请求
   - 检查响应数据

---

## 七、性能优化建议

### 7.1 前端优化

1. **代码分割**
   - 使用React.lazy懒加载组件
   - 减少初始加载时间

2. **请求优化**
   - 使用防抖/节流
   - 避免重复请求

3. **缓存策略**
   - Token缓存到localStorage
   - 列表数据缓存（可选）

### 7.2 后端优化

1. **数据库索引**
   - 为常用查询字段添加索引
   - 优化查询性能

2. **分页查询**
   - 大数据量使用分页
   - 避免一次性加载所有数据

---

## 八、部署说明

### 8.1 前端构建

```bash
cd frontend
npm run build
```

构建产物在 `dist` 目录。

### 8.2 后端打包

```bash
mvn clean package
```

打包文件在 `target` 目录。

### 8.3 生产环境配置

1. **修改API地址**
   - 修改 `vite.config.ts` 中的代理配置
   - 或使用环境变量

2. **配置CORS**
   - 生产环境需要配置正确的CORS策略
   - 只允许特定域名访问

---

## 九、总结

### 9.1 联调检查清单

- [ ] 后端服务正常运行（端口8080）
- [ ] 前端服务正常运行（端口3000）
- [ ] 数据库连接正常
- [ ] CORS配置正确
- [ ] Token管理正常
- [ ] 所有API接口测试通过
- [ ] 页面功能正常

### 9.2 下一步优化

1. 添加员工详情页面
2. 添加批量操作功能
3. 添加数据导出功能
4. 优化移动端体验
5. 添加更多统计图表
6. 添加权限管理
7. 添加操作日志

---

**文档版本：** v1.0  
**最后更新：** 2025-12-29














