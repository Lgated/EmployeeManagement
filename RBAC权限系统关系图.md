# RBAC æƒé™ç³»ç»Ÿå…³ç³»å›¾è§£

## ğŸ“‹ ç›®å½•

1. [æ ¸å¿ƒæ¦‚å¿µå…³ç³»](#1-æ ¸å¿ƒæ¦‚å¿µå…³ç³»)
2. [æ•°æ®åº“ ER å›¾](#2-æ•°æ®åº“-er-å›¾)
3. [åç«¯æ¶æ„å…³ç³»](#3-åç«¯æ¶æ„å…³ç³»)
4. [å‰ç«¯æ¶æ„å…³ç³»](#4-å‰ç«¯æ¶æ„å…³ç³»)
5. [è¯·æ±‚æµç¨‹å›¾](#5-è¯·æ±‚æµç¨‹å›¾)
6. [æƒé™éªŒè¯æµç¨‹](#6-æƒé™éªŒè¯æµç¨‹)
7. [è§’è‰²æƒé™çŸ©é˜µ](#7-è§’è‰²æƒé™çŸ©é˜µ)

---

## 1. æ ¸å¿ƒæ¦‚å¿µå…³ç³»

### 1.1 RBAC æ¨¡å‹æ ¸å¿ƒå…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RBAC æ ¸å¿ƒæ¨¡å‹                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ç”¨æˆ·   â”‚ 1     N â”‚  è§’è‰²   â”‚ N     M â”‚   æƒé™      â”‚
    â”‚  User   â”œâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚  Role   â”œâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Permission  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  æ‹¥æœ‰   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  åŒ…å«   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                   â”‚                      â”‚
         â”‚                   â”‚                      â”‚
    username              SUPER_ADMIN         employee:create
    password               MANAGER            employee:read
    email                  EMPLOYEE           employee:update
    role                      â”‚               employee:delete
    department                â”‚                      â”‚
    employeeId                â”‚                      â”‚
                              â”‚                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
                    â”‚                    â”‚          â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”‚
            â”‚ æƒé™ç­‰çº§ï¼š1    â”‚  â”‚ æƒé™ç­‰çº§ï¼š2   â”‚  â”‚
            â”‚ æ‰€æœ‰æƒé™       â”‚  â”‚ æœ¬éƒ¨é—¨æƒé™    â”‚  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                    â”‚
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ æƒé™ç­‰çº§ï¼š3          â”‚
                                        â”‚ ä¸ªäººæ•°æ®æƒé™         â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç”¨æˆ·-è§’è‰²-æƒé™ä¸‰å…ƒå…³ç³»

```
ç”¨æˆ· (User)
    â”‚
    â”œâ”€ ç›´æ¥å±æ€§
    â”‚   â”œâ”€ id: 1
    â”‚   â”œâ”€ username: "manager1"
    â”‚   â”œâ”€ role: "MANAGER"           â—„â”€â”€â”€ è§’è‰²æ ‡è¯†
    â”‚   â”œâ”€ department: "æŠ€æœ¯éƒ¨"       â—„â”€â”€â”€ æ•°æ®èŒƒå›´
    â”‚   â””â”€ employeeId: null
    â”‚
    â””â”€ é€šè¿‡è§’è‰²è·å¾—æƒé™
        â”‚
        â–¼
    è§’è‰² (Role)
        â”‚
        â”œâ”€ MANAGER
        â”‚   â”œâ”€ level: 2
        â”‚   â””â”€ åŒ…å«æƒé™
        â”‚       â”œâ”€ employee:create   â—„â”€â”€â”€ åˆ›å»ºæƒé™
        â”‚       â”œâ”€ employee:read     â—„â”€â”€â”€ è¯»å–æƒé™
        â”‚       â”œâ”€ employee:update   â—„â”€â”€â”€ æ›´æ–°æƒé™
        â”‚       â”œâ”€ employee:delete   â—„â”€â”€â”€ åˆ é™¤æƒé™
        â”‚       â””â”€ employee:export   â—„â”€â”€â”€ å¯¼å‡ºæƒé™
        â”‚
        â””â”€ æƒé™èŒƒå›´é™åˆ¶
            â””â”€ åªèƒ½æ“ä½œ department = "æŠ€æœ¯éƒ¨" çš„æ•°æ®
```

---

## 2. æ•°æ®åº“ ER å›¾

### 2.1 å®Œæ•´æ•°æ®åº“è¡¨å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ•°æ®åº“è¡¨å…³ç³»å›¾                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   user_account    â”‚         â”‚     employee      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ id (PK)        â”‚         â”‚ â€¢ id (PK)        â”‚
â”‚ â€¢ username       â”‚         â”‚ â€¢ name           â”‚
â”‚ â€¢ password       â”‚         â”‚ â€¢ department     â”‚
â”‚ â€¢ email          â”‚         â”‚ â€¢ position       â”‚
â”‚ â€¢ role           â”‚â”€â”€â”€â”     â”‚ â€¢ salary         â”‚
â”‚ â€¢ department     â”‚   â”‚     â”‚ â€¢ hire_date      â”‚
â”‚ â€¢ employee_id    â”‚â”€â”€â”€â”¼â”€â”€â”€â”€>â”‚ â€¢ avatar         â”‚
â”‚ â€¢ enabled        â”‚   â”‚     â”‚ â€¢ created_by     â”‚
â”‚ â€¢ created_at     â”‚   â”‚     â”‚ â€¢ updated_by     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚ â€¢ deleted        â”‚
         â”‚              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚              â–²
         â”‚ FK           â”‚              â”‚
         â–¼              â”‚              â”‚ FK
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚  operation_log    â”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚     â”‚   æ•°æ®èŒƒå›´æ£€æŸ¥    â”‚
â”‚ â€¢ id (PK)        â”‚   â”‚     â”‚                  â”‚
â”‚ â€¢ user_id (FK)   â”‚â”€â”€â”€â”˜     â”‚ éƒ¨é—¨ç»ç†ï¼š       â”‚
â”‚ â€¢ username       â”‚         â”‚ user.department  â”‚
â”‚ â€¢ operation_type â”‚         â”‚ = employee.dept  â”‚
â”‚ â€¢ module         â”‚         â”‚                  â”‚
â”‚ â€¢ description    â”‚         â”‚ æ™®é€šå‘˜å·¥ï¼š       â”‚
â”‚ â€¢ method         â”‚         â”‚ user.employee_id â”‚
â”‚ â€¢ params         â”‚         â”‚ = employee.id    â”‚
â”‚ â€¢ result         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â€¢ ip_address     â”‚
â”‚ â€¢ execution_time â”‚
â”‚ â€¢ status         â”‚
â”‚ â€¢ error_message  â”‚
â”‚ â€¢ created_at     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       role        â”‚       â”‚ role_permission  â”‚       â”‚   permission   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ id (PK)        â”‚<â”€â”€â”€â”€â”€â”€â”‚ â€¢ id (PK)       â”‚â”€â”€â”€â”€â”€â”€>â”‚ â€¢ id (PK)     â”‚
â”‚ â€¢ code           â”‚   1   â”‚ â€¢ role_id (FK)  â”‚   M   â”‚ â€¢ code        â”‚
â”‚ â€¢ name           â”‚       â”‚ â€¢ permission_id â”‚       â”‚ â€¢ name        â”‚
â”‚ â€¢ description    â”‚       â”‚   (FK)          â”‚       â”‚ â€¢ resource    â”‚
â”‚ â€¢ level          â”‚       â”‚ â€¢ created_at    â”‚       â”‚ â€¢ action      â”‚
â”‚ â€¢ created_at     â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â€¢ description â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                                                      â–²
         â”‚                                                      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          N : M å¤šå¯¹å¤šå…³ç³»
```

### 2.2 è¡¨å…³ç³»è¯¦è§£

```
1. user_account â†â†’ employee (1:1 æˆ– 1:0)
   å…³ç³»ï¼šæ™®é€šå‘˜å·¥ç”¨æˆ·å…³è”ä¸€ä¸ªå‘˜å·¥è®°å½•
   å­—æ®µï¼šuser_account.employee_id = employee.id
   
2. user_account â†’ operation_log (1:N)
   å…³ç³»ï¼šä¸€ä¸ªç”¨æˆ·äº§ç”Ÿå¤šæ¡æ“ä½œæ—¥å¿—
   å­—æ®µï¼šoperation_log.user_id = user_account.id
   
3. role â†â†’ permission (M:N)
   å…³ç³»ï¼šè§’è‰²å’Œæƒé™å¤šå¯¹å¤š
   ä¸­é—´è¡¨ï¼šrole_permission
   
4. user_account éšå«å¼•ç”¨ role
   å…³ç³»ï¼šé€šè¿‡ role å­—æ®µï¼ˆæšä¸¾å€¼ï¼‰å…³è”
   å­—æ®µï¼šuser_account.role = role.code
```

---

## 3. åç«¯æ¶æ„å…³ç³»

### 3.1 åˆ†å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å®¢æˆ·ç«¯è¯·æ±‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¿‡æ»¤å™¨å±‚ (Filter Layer)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         JwtAuthFilter (JWT è®¤è¯è¿‡æ»¤å™¨)                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ 1. ä»è¯·æ±‚å¤´æå– Token                            â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ 2. éªŒè¯ Token æœ‰æ•ˆæ€§                             â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ 3. è§£æç”¨æˆ·ä¿¡æ¯ (userId, username, role)         â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ 4. å­˜å…¥ SecurityContext                          â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ§åˆ¶å™¨å±‚ (Controller Layer)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚    EmployeeController                                 â”‚    â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚    â”‚ @RequiresPermission("employee:create")       â”‚   â”‚    â”‚
â”‚  â”‚    â”‚ public Result create(...)                    â”‚   â”‚    â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â”‚                                          â”‚
â”‚                      â”‚ æ–¹æ³•è°ƒç”¨                                 â”‚
â”‚                      â–¼                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åˆ‡é¢å±‚ (Aspect Layer)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         PermissionAspect (æƒé™æ£€æŸ¥åˆ‡é¢)               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ @Before("@annotation(RequiresPermission)")       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ â”‚ 1. è·å–å½“å‰ç”¨æˆ·ID (SecurityUtil)           â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ â”‚ 2. æå–æƒé™æ³¨è§£ä¿¡æ¯                        â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ â”‚ 3. è°ƒç”¨ PermissionService.hasPermission() â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ â”‚ 4. æ£€æŸ¥æ•°æ®èŒƒå›´æƒé™                        â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ â”‚ 5. é€šè¿‡ â†’ ç»§ç»­æ‰§è¡Œ                         â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ â”‚ 6. å¤±è´¥ â†’ æŠ›å‡º PermissionDeniedException   â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â”‚                                          â”‚
â”‚                      â”‚ æƒé™éªŒè¯é€šè¿‡                             â”‚
â”‚                      â–¼                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœåŠ¡å±‚ (Service Layer)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ EmployeeService â”‚        â”‚  PermissionService       â”‚      â”‚
â”‚  â”‚  â”œâ”€ create()    â”‚        â”‚  â”œâ”€ hasPermission()      â”‚      â”‚
â”‚  â”‚  â”œâ”€ update()    â”‚        â”‚  â”œâ”€ hasRole()            â”‚      â”‚
â”‚  â”‚  â”œâ”€ delete()    â”‚        â”‚  â”œâ”€ canAccessDepartment()â”‚      â”‚
â”‚  â”‚  â””â”€ findById()  â”‚        â”‚  â””â”€ canAccessEmployee()  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                            â”‚                        â”‚
â”‚           â”‚                            â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                            â”‚
            â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æŒä¹…å±‚ (Repository Layer)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ EmployeeRepositoryâ”‚      â”‚  UserRepository  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚           â”‚                         â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                         â”‚
            â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®åº“ (Database)                         â”‚
â”‚                         PostgreSQL                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒç±»å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åç«¯æ ¸å¿ƒç±»å…³ç³»                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ³¨è§£ç±» (Annotations)
â”œâ”€ @RequiresPermission
â”‚   â””â”€ å±æ€§: value, checkDepartment, checkOwner
â””â”€ @RequiresRole
    â””â”€ å±æ€§: value[]

                    â”‚
                    â”‚ ä½¿ç”¨äº
                    â–¼
            
Controller (æ§åˆ¶å™¨)
â”œâ”€ EmployeeController
â”‚   â”œâ”€ @RequiresPermission("employee:create")
â”‚   â”œâ”€ @RequiresPermission("employee:read")
â”‚   â””â”€ @RequiresPermission("employee:delete")
â””â”€ UserController
    â””â”€ @RequiresRole("SUPER_ADMIN")

                    â”‚
                    â”‚ æ‹¦æˆª
                    â–¼

Aspect (åˆ‡é¢)
â””â”€ PermissionAspect
    â”œâ”€ checkPermission()   â—„â”€â”€ @Before æ‹¦æˆª @RequiresPermission
    â””â”€ checkRole()         â—„â”€â”€ @Before æ‹¦æˆª @RequiresRole
            â”‚
            â”‚ è°ƒç”¨
            â–¼

Service (æœåŠ¡)
â””â”€ PermissionService
    â”œâ”€ hasPermission()         â†’ æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æŒ‡å®šæƒé™
    â”œâ”€ hasRole()               â†’ æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æŒ‡å®šè§’è‰²
    â”œâ”€ canAccessDepartment()   â†’ æ£€æŸ¥éƒ¨é—¨è®¿é—®æƒé™
    â””â”€ canAccessEmployee()     â†’ æ£€æŸ¥å‘˜å·¥è®¿é—®æƒé™
            â”‚
            â”‚ æŸ¥è¯¢
            â–¼

Repository (æ•°æ®è®¿é—®)
â”œâ”€ UserRepository          â†’ æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
â”œâ”€ EmployeeRepository      â†’ æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯
â””â”€ PermissionRepository    â†’ æŸ¥è¯¢æƒé™ä¿¡æ¯ (æ‰©å±•åŠŸèƒ½)

            â”‚
            â”‚ æ˜ å°„
            â–¼

Domain (é¢†åŸŸæ¨¡å‹)
â”œâ”€ User
â”‚   â”œâ”€ id
â”‚   â”œâ”€ username
â”‚   â”œâ”€ role           â—„â”€â”€ å…³é”®å­—æ®µ
â”‚   â”œâ”€ department     â—„â”€â”€ æ•°æ®èŒƒå›´
â”‚   â””â”€ employeeId     â—„â”€â”€ æ•°æ®èŒƒå›´
â”œâ”€ Employee
â”‚   â”œâ”€ id
â”‚   â””â”€ department     â—„â”€â”€ ç”¨äºéƒ¨é—¨æƒé™æ£€æŸ¥
â””â”€ Permission
    â”œâ”€ code
    â”œâ”€ resource
    â””â”€ action

            â”‚
            â”‚ æšä¸¾
            â–¼

Enum (æšä¸¾)
â””â”€ RoleEnum
    â”œâ”€ SUPER_ADMIN (level=1)
    â”œâ”€ MANAGER (level=2)
    â””â”€ EMPLOYEE (level=3)
```

### 3.3 å·¥å…·ç±»å…³ç³»

```
SecurityUtil (å®‰å…¨å·¥å…·ç±»)
â”œâ”€ getCurrentUserId()        â†’ ä» SecurityContext è·å–ç”¨æˆ·ID
â”œâ”€ getCurrentUsername()      â†’ ä» SecurityContext è·å–ç”¨æˆ·å
â”œâ”€ getCurrentUserRole()      â†’ ä» SecurityContext è·å–è§’è‰²
â”œâ”€ getCurrentUserDepartment()â†’ ä» SecurityContext è·å–éƒ¨é—¨
â””â”€ getCurrentEmployeeId()    â†’ ä» SecurityContext è·å–å‘˜å·¥ID
        â”‚
        â”‚ æ•°æ®æ¥æº
        â–¼
SecurityContext (Spring Security ä¸Šä¸‹æ–‡)
        â”‚
        â”‚ æ•°æ®ç”±è°è®¾ç½®ï¼Ÿ
        â–¼
JwtAuthFilter (JWT è¿‡æ»¤å™¨)
â”œâ”€ è§£æ Token
â”œâ”€ æå–ç”¨æˆ·ä¿¡æ¯
â””â”€ è®¾ç½®åˆ° SecurityContext
        â”‚
        â”‚ Token ç”Ÿæˆ
        â–¼
JwtUtil (JWT å·¥å…·ç±»)
â”œâ”€ generateToken(User)       â†’ ç”ŸæˆåŒ…å«è§’è‰²çš„Token
â”œâ”€ getRoleFromToken()        â†’ ä»Tokenæå–è§’è‰²
â””â”€ getDepartmentFromToken()  â†’ ä»Tokenæå–éƒ¨é—¨
```

---

## 4. å‰ç«¯æ¶æ„å…³ç³»

### 4.1 å‰ç«¯ç»„ä»¶å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯æ¶æ„å…³ç³»                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é¡µé¢ç»„ä»¶ (Pages)
â”œâ”€ Login.tsx
â”‚   â”œâ”€ ç™»å½•æˆåŠŸå
â”‚   â”œâ”€ ä¿å­˜ Token â†’ authStore.setAuth()
â”‚   â””â”€ ä¿å­˜æƒé™ä¿¡æ¯ â†’ permissionStore.setRole()
â”‚
â”œâ”€ EmployeeList.tsx
â”‚   â”œâ”€ ä½¿ç”¨ <PermissionButton permission="employee:create">
â”‚   â”œâ”€ ä½¿ç”¨ <PermissionGuard permission="employee:delete">
â”‚   â””â”€ è°ƒç”¨ usePermissionStore().hasPermission()
â”‚
â””â”€ Layout.tsx
    â”œâ”€ æ ¹æ®è§’è‰²æ˜¾ç¤ºèœå•
    â””â”€ ä½¿ç”¨ usePermissionStore().isAdmin()

                â”‚
                â”‚ ä½¿ç”¨
                â–¼

UI ç»„ä»¶ (Components)
â”œâ”€ PermissionGuard
â”‚   â””â”€ æ ¹æ®æƒé™æ˜¾ç¤º/éšè—å†…å®¹
â”‚       â”œâ”€ Props: permission, role, fallback
â”‚       â””â”€ é€»è¾‘: è°ƒç”¨ permissionStore.hasPermission()
â”‚
â””â”€ PermissionButton
    â””â”€ æ ¹æ®æƒé™æ˜¾ç¤º/éšè—æŒ‰é’®
        â”œâ”€ Props: permission, role
        â””â”€ é€»è¾‘: è°ƒç”¨ permissionStore.hasPermission()

                â”‚
                â”‚ è°ƒç”¨
                â–¼

çŠ¶æ€ç®¡ç† (Stores)
â”œâ”€ authStore (è®¤è¯çŠ¶æ€)
â”‚   â”œâ”€ token
â”‚   â”œâ”€ username
â”‚   â”œâ”€ isAuthenticated
â”‚   â”œâ”€ setAuth()
â”‚   â””â”€ clearAuth()
â”‚
â””â”€ permissionStore (æƒé™çŠ¶æ€)
    â”œâ”€ role              â—„â”€â”€ è§’è‰²
    â”œâ”€ department        â—„â”€â”€ éƒ¨é—¨
    â”œâ”€ employeeId        â—„â”€â”€ å‘˜å·¥ID
    â”œâ”€ permissions[]     â—„â”€â”€ æƒé™åˆ—è¡¨
    â”‚
    â”œâ”€ æ–¹æ³•
    â”‚   â”œâ”€ hasPermission()   â†’ æ£€æŸ¥æ˜¯å¦æœ‰æƒé™
    â”‚   â”œâ”€ hasRole()         â†’ æ£€æŸ¥æ˜¯å¦æœ‰è§’è‰²
    â”‚   â”œâ”€ isAdmin()         â†’ æ˜¯å¦è¶…ç®¡
    â”‚   â”œâ”€ isManager()       â†’ æ˜¯å¦ç»ç†
    â”‚   â””â”€ isEmployee()      â†’ æ˜¯å¦å‘˜å·¥
    â”‚
    â””â”€ æŒä¹…åŒ–åˆ° localStorage

                â”‚
                â”‚ è°ƒç”¨
                â–¼

API å±‚ (API)
â”œâ”€ auth.ts
â”‚   â”œâ”€ login()           â†’ POST /api/auth/login
â”‚   â”‚   â””â”€ è¿”å›: { token, username, role, department, permissions }
â”‚   â””â”€ register()
â”‚
â”œâ”€ employee.ts
â”‚   â”œâ”€ getEmployeeList() â†’ GET /api/employ
â”‚   â”œâ”€ createEmployee()  â†’ POST /api/employ
â”‚   â””â”€ deleteEmployee()  â†’ DELETE /api/employ/:id
â”‚
â””â”€ log.ts
    â””â”€ getOperationLogs()â†’ GET /api/logs

                â”‚
                â”‚ ä½¿ç”¨
                â–¼

HTTP å®¢æˆ·ç«¯ (Utils)
â””â”€ request.ts
    â”œâ”€ è¯·æ±‚æ‹¦æˆªå™¨: æ·»åŠ  Token åˆ° Header
    â”œâ”€ å“åº”æ‹¦æˆªå™¨: ç»Ÿä¸€å¤„ç†å“åº”
    â””â”€ é”™è¯¯å¤„ç†: 401 â†’ æ¸…é™¤è®¤è¯ï¼Œè·³è½¬ç™»å½•
```

### 4.2 å‰ç«¯æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯æ•°æ®æµ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ç™»å½•æµç¨‹
   â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç”¨æˆ· â”‚â”€â”€â”€â”€â”€>â”‚ Loginé¡µé¢ â”‚â”€â”€â”€â”€â”€>â”‚ auth.ts  â”‚â”€â”€â”€â”€â”€>â”‚  åç«¯    â”‚
   â””â”€â”€â”€â”€â”€â”€â”˜ è¾“å…¥ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ è°ƒç”¨ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ HTTP â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ç”¨æˆ·åå¯†ç         â”‚                   â”‚               â”‚
                    â”‚                   â”‚               â”‚
                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚  è¿”å›Tokenå’Œæƒé™ä¿¡æ¯
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   ä¿å­˜åˆ° Store   â”‚
            â”‚  â”œâ”€ authStore   â”‚
            â”‚  â”‚   â””â”€ token   â”‚
            â”‚  â””â”€ permission  â”‚
            â”‚      Store      â”‚
            â”‚      â”œâ”€ role    â”‚
            â”‚      â”œâ”€ dept    â”‚
            â”‚      â””â”€ perms   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ æŒä¹…åŒ–
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  localStorage   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


2. æƒé™æ£€æŸ¥æµç¨‹
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  é¡µé¢/ç»„ä»¶   â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ è°ƒç”¨
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ permissionStore      â”‚
   â”‚ .hasPermission()     â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ è¯»å–
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   æƒé™çŠ¶æ€           â”‚
   â”‚   â”œâ”€ role           â”‚
   â”‚   â””â”€ permissions[]  â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ åˆ¤æ–­é€»è¾‘
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  è¶…ç®¡: è¿”å› true     â”‚
   â”‚  å…¶ä»–: æ£€æŸ¥æ•°ç»„      â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  æ˜¾ç¤º/éšè—ç»„ä»¶       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


3. API è¯·æ±‚æµç¨‹
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ç»„ä»¶    â”‚â”€â”€â”€â”€â”€>â”‚ employee.tsâ”‚â”€â”€â”€â”€â”€>â”‚ request.ts  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ è°ƒç”¨ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ è°ƒç”¨ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ æ‹¦æˆªå™¨
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ æ·»åŠ  Header: â”‚
                                        â”‚ Authorizationâ”‚
                                        â”‚ Bearer token â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ HTTP
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚    åç«¯API   â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ è¿”å›
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ å“åº”æ‹¦æˆªå™¨   â”‚
                                        â”‚ â”œâ”€ 200: OK  â”‚
                                        â”‚ â””â”€ 403: æ— æƒâ”‚
                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚   ç»„ä»¶æ¥æ”¶   â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. è¯·æ±‚æµç¨‹å›¾

### 5.1 å®Œæ•´è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä»å‰ç«¯ç‚¹å‡»æŒ‰é’®åˆ°åç«¯è¿”å›æ•°æ®çš„å®Œæ•´æµç¨‹                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€å‰ç«¯ã€‘

1. ç”¨æˆ·æ“ä½œ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç”¨æˆ·ç‚¹å‡»"åˆ é™¤"æŒ‰é’® â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
2. å‰ç«¯æƒé™æ£€æŸ¥
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ <PermissionButton               â”‚
   â”‚   permission="employee:delete"> â”‚
   â”‚                                 â”‚
   â”‚ â†’ permissionStore.hasPermissionâ”‚
   â”‚   ("employee:delete")          â”‚
   â”‚                                 â”‚
   â”‚   â”œâ”€ æœ‰æƒé™: æ˜¾ç¤ºæŒ‰é’®           â”‚
   â”‚   â””â”€ æ— æƒé™: éšè—æŒ‰é’®           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ æœ‰æƒé™
             â–¼
3. å‘èµ· API è¯·æ±‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ deleteEmployee(id)            â”‚
   â”‚ â†“                             â”‚
   â”‚ request.delete(`/employ/${id}`)â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
4. è¯·æ±‚æ‹¦æˆªå™¨
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ request.interceptors.request  â”‚
   â”‚ â†“                             â”‚
   â”‚ æ·»åŠ  Header:                  â”‚
   â”‚ Authorization: Bearer {token} â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ HTTP DELETE
             â”‚
â”â”â”â”â”â”â”â”â”â”â”â”â”¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  ç½‘ç»œä¼ è¾“
             â”‚
             â–¼

ã€åç«¯ã€‘

5. Spring Security è¿‡æ»¤å™¨
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ JwtAuthFilter                 â”‚
   â”‚ â†“                             â”‚
   â”‚ 1. æå– Token                 â”‚
   â”‚ 2. éªŒè¯ Token                 â”‚
   â”‚ 3. è§£æç”¨æˆ·ä¿¡æ¯:              â”‚
   â”‚    - userId: 2                â”‚
   â”‚    - role: "MANAGER"          â”‚
   â”‚    - department: "æŠ€æœ¯éƒ¨"     â”‚
   â”‚ 4. å­˜å…¥ SecurityContext       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
6. åˆ°è¾¾ Controller
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ @DeleteMapping("/{id}")              â”‚
   â”‚ @RequiresPermission(                 â”‚
   â”‚   value = "employee:delete",         â”‚
   â”‚   checkDepartment = true             â”‚
   â”‚ )                                    â”‚
   â”‚ public Result delete(@PathVariable id)â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ æ–¹æ³•è°ƒç”¨å‰
             â–¼
7. æƒé™åˆ‡é¢æ‹¦æˆª
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ PermissionAspect                  â”‚
   â”‚ @Before                           â”‚
   â”‚ â†“                                 â”‚
   â”‚ checkPermission() {               â”‚
   â”‚   1. è·å–å½“å‰ç”¨æˆ·                 â”‚
   â”‚      userId = SecurityUtil        â”‚
   â”‚        .getCurrentUserId()        â”‚
   â”‚                                   â”‚
   â”‚   2. æå–æ³¨è§£ä¿¡æ¯                 â”‚
   â”‚      permission = "employee:delete"â”‚
   â”‚      checkDept = true             â”‚
   â”‚                                   â”‚
   â”‚   3. åŸºç¡€æƒé™æ£€æŸ¥                 â”‚
   â”‚      PermissionService            â”‚
   â”‚        .hasPermission(userId,     â”‚
   â”‚          "employee:delete")       â”‚
   â”‚                                   â”‚
   â”‚   4. æ•°æ®èŒƒå›´æ£€æŸ¥                 â”‚
   â”‚      (å› ä¸º checkDepartment=true)  â”‚
   â”‚      - æŸ¥è¯¢å‘˜å·¥çš„éƒ¨é—¨             â”‚
   â”‚      - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦èƒ½è®¿é—®è¯¥éƒ¨é—¨   â”‚
   â”‚                                   â”‚
   â”‚   5. ç»“æœåˆ¤æ–­                     â”‚
   â”‚      â”œâ”€ é€šè¿‡: ç»§ç»­æ‰§è¡Œ            â”‚
   â”‚      â””â”€ å¤±è´¥: æŠ›å‡ºå¼‚å¸¸            â”‚
   â”‚         PermissionDeniedException â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ æƒé™éªŒè¯é€šè¿‡
             â–¼
8. æ‰§è¡Œä¸šåŠ¡é€»è¾‘
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ EmployeeService.delete(id)    â”‚
   â”‚ â†“                             â”‚
   â”‚ 1. æŸ¥è¯¢å‘˜å·¥                   â”‚
   â”‚ 2. æ ‡è®°ä¸ºå·²åˆ é™¤               â”‚
   â”‚ 3. ä¿å­˜åˆ°æ•°æ®åº“               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
9. æ“ä½œæ—¥å¿—è®°å½•
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ OperationLogAspect            â”‚
   â”‚ @Around                       â”‚
   â”‚ â†“                             â”‚
   â”‚ è®°å½•æ—¥å¿—:                     â”‚
   â”‚ - æ“ä½œäºº: userId              â”‚
   â”‚ - æ“ä½œç±»å‹: DELETE            â”‚
   â”‚ - æ¨¡å—: EMPLOYEE              â”‚
   â”‚ - IPåœ°å€: xxx.xxx.xxx.xxx    â”‚
   â”‚ - æ‰§è¡Œæ—¶é—´: 25ms              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
10. è¿”å›å“åº”
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Result.success(null)          â”‚
   â”‚ {                             â”‚
   â”‚   code: 200,                  â”‚
   â”‚   message: "è¿”å›æˆåŠŸ",        â”‚
   â”‚   data: null                  â”‚
   â”‚ }                             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ HTTP Response
             â”‚
â”â”â”â”â”â”â”â”â”â”â”â”â”¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  ç½‘ç»œä¼ è¾“
             â”‚
             â–¼

ã€å‰ç«¯ã€‘

11. å“åº”æ‹¦æˆªå™¨
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ request.interceptors.response â”‚
   â”‚ â†“                             â”‚
   â”‚ 1. æ£€æŸ¥ code                  â”‚
   â”‚    â””â”€ 200: æˆåŠŸ               â”‚
   â”‚ 2. è¿”å› data éƒ¨åˆ†             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
12. ç»„ä»¶æ¥æ”¶ç»“æœ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯                  â”‚
   â”‚ åˆ·æ–°åˆ—è¡¨                      â”‚
   â”‚ message.success("åˆ é™¤æˆåŠŸ")   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æƒé™æ£€æŸ¥å¤±è´¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æƒé™æ£€æŸ¥å¤±è´¥æ—¶çš„å¤„ç†æµç¨‹                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åœºæ™¯ï¼šéƒ¨é—¨ç»ç†å°è¯•åˆ é™¤å…¶ä»–éƒ¨é—¨çš„å‘˜å·¥

ã€åç«¯æƒé™æ£€æŸ¥ã€‘

PermissionAspect.checkPermission()
   â”‚
   â”œâ”€ 1. åŸºç¡€æƒé™æ£€æŸ¥
   â”‚     hasPermission(userId, "employee:delete")
   â”‚     â””â”€ âœ… é€šè¿‡ï¼ˆéƒ¨é—¨ç»ç†æœ‰åˆ é™¤æƒé™ï¼‰
   â”‚
   â”œâ”€ 2. æ•°æ®èŒƒå›´æ£€æŸ¥ (checkDepartment = true)
   â”‚     â”‚
   â”‚     â”œâ”€ è·å–ç›®æ ‡å‘˜å·¥ä¿¡æ¯
   â”‚     â”‚    SELECT * FROM employee WHERE id = 5
   â”‚     â”‚    â†’ department = "é”€å”®éƒ¨"
   â”‚     â”‚
   â”‚     â”œâ”€ è·å–å½“å‰ç”¨æˆ·éƒ¨é—¨
   â”‚     â”‚    SecurityUtil.getCurrentUserDepartment()
   â”‚     â”‚    â†’ "æŠ€æœ¯éƒ¨"
   â”‚     â”‚
   â”‚     â””â”€ å¯¹æ¯”éƒ¨é—¨
   â”‚          "æŠ€æœ¯éƒ¨" â‰  "é”€å”®éƒ¨"
   â”‚          â””â”€ âŒ å¤±è´¥ï¼
   â”‚
   â””â”€ 3. æŠ›å‡ºå¼‚å¸¸
        throw new PermissionDeniedException(
          "åªèƒ½æ“ä½œæœ¬éƒ¨é—¨çš„æ•°æ®"
        )

              â”‚
              â–¼

ã€å¼‚å¸¸å¤„ç†ã€‘

GlobalExceptionHandler
   â”‚
   â”œâ”€ @ExceptionHandler(PermissionDeniedException.class)
   â”‚
   â””â”€ è¿”å›å“åº”
        {
          code: 403,
          message: "åªèƒ½æ“ä½œæœ¬éƒ¨é—¨çš„æ•°æ®",
          data: null
        }

              â”‚
              â”‚ HTTP 403 Forbidden
              â–¼

ã€å‰ç«¯å¤„ç†ã€‘

å“åº”æ‹¦æˆªå™¨
   â”‚
   â”œâ”€ æ£€æµ‹åˆ° code === 403
   â”‚
   â”œâ”€ æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
   â”‚    message.error("åªèƒ½æ“ä½œæœ¬éƒ¨é—¨çš„æ•°æ®")
   â”‚
   â””â”€ è¿”å› Promise.reject()

              â”‚
              â–¼

ç»„ä»¶ catch å—
   â”‚
   â””â”€ å¤„ç†é”™è¯¯
        catch (error) {
          // ç”¨æˆ·å·²ç»çœ‹åˆ°é”™è¯¯æç¤º
          // ä¸éœ€è¦é¢å¤–å¤„ç†
        }
```

---

## 6. æƒé™éªŒè¯æµç¨‹

### 6.1 å¤šå±‚æƒé™æ£€æŸ¥æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤šå±‚æƒé™æ£€æŸ¥æœºåˆ¶                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ä¸€å±‚: å‰ç«¯UIå±‚æ£€æŸ¥ (å¯ç»•è¿‡ï¼Œä»…ç”¨äºä½“éªŒ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <PermissionButton                       â”‚
â”‚   permission="employee:delete">         â”‚
â”‚   åˆ é™¤                                  â”‚
â”‚ </PermissionButton>                     â”‚
â”‚                                         â”‚
â”‚ é€»è¾‘:                                   â”‚
â”‚ if (!hasPermission("employee:delete")) {â”‚
â”‚   return null  // ä¸æ˜¾ç¤ºæŒ‰é’®            â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ å¦‚æœç»•è¿‡å‰ç«¯æ£€æŸ¥
              â–¼
ç¬¬äºŒå±‚: HTTP è®¤è¯å±‚ (Spring Security)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JwtAuthFilter                           â”‚
â”‚ â”œâ”€ éªŒè¯ Token æ˜¯å¦æœ‰æ•ˆ                  â”‚
â”‚ â”œâ”€ éªŒè¯ Token æ˜¯å¦è¿‡æœŸ                  â”‚
â”‚ â””â”€ è§£æç”¨æˆ·èº«ä»½ä¿¡æ¯                     â”‚
â”‚                                         â”‚
â”‚ ç»“æœ:                                   â”‚
â”‚ â”œâ”€ Token æ— æ•ˆ: è¿”å› 401                â”‚
â”‚ â”œâ”€ Token è¿‡æœŸ: è¿”å› 401                â”‚
â”‚ â””â”€ Token æœ‰æ•ˆ: ç»§ç»­                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ è®¤è¯é€šè¿‡
              â–¼
ç¬¬ä¸‰å±‚: æ–¹æ³•æƒé™å±‚ (@RequiresPermission)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PermissionAspect.checkPermission()      â”‚
â”‚                                         â”‚
â”‚ æ­¥éª¤1: åŸºç¡€æƒé™æ£€æŸ¥                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ PermissionService                  â”‚ â”‚
â”‚ â”‚   .hasPermission(userId, permission)â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ é€»è¾‘:                               â”‚ â”‚
â”‚ â”‚ 1. è·å–ç”¨æˆ·è§’è‰²                     â”‚ â”‚
â”‚ â”‚ 2. è¶…ç®¡: è¿”å› true                 â”‚ â”‚
â”‚ â”‚ 3. å…¶ä»–: æ£€æŸ¥è§’è‰²æƒé™åˆ—è¡¨           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â”‚                          â”‚
â”‚              â–¼                          â”‚
â”‚ æ­¥éª¤2: æ•°æ®èŒƒå›´æ£€æŸ¥ (å¦‚æœéœ€è¦)          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ checkDepartment æˆ– checkOwner      â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ éƒ¨é—¨ç»ç†:                           â”‚ â”‚
â”‚ â”‚ user.department == data.department  â”‚ â”‚
â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚ æ™®é€šå‘˜å·¥:                           â”‚ â”‚
â”‚ â”‚ user.employeeId == data.id          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â”‚                          â”‚
â”‚              â–¼                          â”‚
â”‚ ç»“æœ:                                   â”‚
â”‚ â”œâ”€ æ— æƒé™: æŠ›å‡º 403                    â”‚
â”‚ â””â”€ æœ‰æƒé™: ç»§ç»­æ‰§è¡Œ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ æƒé™éªŒè¯é€šè¿‡
              â–¼
ç¬¬å››å±‚: ä¸šåŠ¡é€»è¾‘å±‚ (å¯é€‰çš„äºŒæ¬¡æ£€æŸ¥)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EmployeeService.delete(id)              â”‚
â”‚                                         â”‚
â”‚ // å¯ä»¥åœ¨ä¸šåŠ¡é€»è¾‘ä¸­å†æ¬¡æ£€æŸ¥            â”‚
â”‚ String role = SecurityUtil              â”‚
â”‚   .getCurrentUserRole();                â”‚
â”‚                                         â”‚
â”‚ if ("EMPLOYEE".equals(role)) {          â”‚
â”‚   throw new BusinessException(          â”‚
â”‚     "å‘˜å·¥ä¸èƒ½åˆ é™¤æ•°æ®");                â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
        æ‰§è¡Œåˆ é™¤æ“ä½œ
```

### 6.2 ä¸åŒè§’è‰²çš„æƒé™éªŒè¯è·¯å¾„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸åŒè§’è‰²è®¿é—®åŒä¸€ä¸ªAPIçš„è·¯å¾„                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

API: DELETE /api/employ/5 (åˆ é™¤IDä¸º5çš„å‘˜å·¥)
å‘˜å·¥ä¿¡æ¯: { id: 5, name: "å¼ ä¸‰", department: "æŠ€æœ¯éƒ¨" }


ã€è¶…çº§ç®¡ç†å‘˜ã€‘role = "SUPER_ADMIN"
   â”‚
   â”œâ”€ 1. JWT è®¤è¯: âœ… é€šè¿‡
   â”‚
   â”œâ”€ 2. åŸºç¡€æƒé™æ£€æŸ¥
   â”‚      hasPermission(userId, "employee:delete")
   â”‚      â†’ è¶…ç®¡æ‹¥æœ‰æ‰€æœ‰æƒé™
   â”‚      â””â”€ âœ… é€šè¿‡
   â”‚
   â”œâ”€ 3. æ•°æ®èŒƒå›´æ£€æŸ¥
   â”‚      checkDepartment = true
   â”‚      â†’ è¶…ç®¡å¯ä»¥è®¿é—®æ‰€æœ‰éƒ¨é—¨
   â”‚      â””â”€ âœ… é€šè¿‡ (è·³è¿‡æ£€æŸ¥)
   â”‚
   â””â”€ 4. æ‰§è¡Œåˆ é™¤
        â””â”€ âœ… æˆåŠŸ


ã€æŠ€æœ¯éƒ¨ç»ç†ã€‘role = "MANAGER", department = "æŠ€æœ¯éƒ¨"
   â”‚
   â”œâ”€ 1. JWT è®¤è¯: âœ… é€šè¿‡
   â”‚
   â”œâ”€ 2. åŸºç¡€æƒé™æ£€æŸ¥
   â”‚      hasPermission(userId, "employee:delete")
   â”‚      â†’ ç»ç†æ‹¥æœ‰åˆ é™¤æƒé™
   â”‚      â””â”€ âœ… é€šè¿‡
   â”‚
   â”œâ”€ 3. æ•°æ®èŒƒå›´æ£€æŸ¥
   â”‚      checkDepartment = true
   â”‚      â”‚
   â”‚      â”œâ”€ ç”¨æˆ·éƒ¨é—¨: "æŠ€æœ¯éƒ¨"
   â”‚      â”œâ”€ å‘˜å·¥éƒ¨é—¨: "æŠ€æœ¯éƒ¨"
   â”‚      â””â”€ "æŠ€æœ¯éƒ¨" == "æŠ€æœ¯éƒ¨"
   â”‚          â””â”€ âœ… é€šè¿‡
   â”‚
   â””â”€ 4. æ‰§è¡Œåˆ é™¤
        â””â”€ âœ… æˆåŠŸ


ã€é”€å”®éƒ¨ç»ç†ã€‘role = "MANAGER", department = "é”€å”®éƒ¨"
   â”‚
   â”œâ”€ 1. JWT è®¤è¯: âœ… é€šè¿‡
   â”‚
   â”œâ”€ 2. åŸºç¡€æƒé™æ£€æŸ¥
   â”‚      hasPermission(userId, "employee:delete")
   â”‚      â†’ ç»ç†æ‹¥æœ‰åˆ é™¤æƒé™
   â”‚      â””â”€ âœ… é€šè¿‡
   â”‚
   â”œâ”€ 3. æ•°æ®èŒƒå›´æ£€æŸ¥
   â”‚      checkDepartment = true
   â”‚      â”‚
   â”‚      â”œâ”€ ç”¨æˆ·éƒ¨é—¨: "é”€å”®éƒ¨"
   â”‚      â”œâ”€ å‘˜å·¥éƒ¨é—¨: "æŠ€æœ¯éƒ¨"
   â”‚      â””â”€ "é”€å”®éƒ¨" â‰  "æŠ€æœ¯éƒ¨"
   â”‚          â””â”€ âŒ å¤±è´¥
   â”‚
   â””â”€ 4. æŠ›å‡ºå¼‚å¸¸
        â””â”€ 403 Forbidden: "åªèƒ½æ“ä½œæœ¬éƒ¨é—¨çš„æ•°æ®"


ã€æ™®é€šå‘˜å·¥ã€‘role = "EMPLOYEE"
   â”‚
   â”œâ”€ 1. JWT è®¤è¯: âœ… é€šè¿‡
   â”‚
   â”œâ”€ 2. åŸºç¡€æƒé™æ£€æŸ¥
   â”‚      hasPermission(userId, "employee:delete")
   â”‚      â†’ æ™®é€šå‘˜å·¥æ²¡æœ‰åˆ é™¤æƒé™
   â”‚      â””â”€ âŒ å¤±è´¥
   â”‚
   â””â”€ 3. æŠ›å‡ºå¼‚å¸¸
        â””â”€ 403 Forbidden: "æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ"
```

---

## 7. è§’è‰²æƒé™çŸ©é˜µ

### 7.1 å®Œæ•´æƒé™çŸ©é˜µè¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è§’è‰²æƒé™å¯¹ç…§è¡¨                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æƒé™ä»£ç               â”‚ SUPER_ADMIN â”‚ MANAGER â”‚ EMPLOYEE â”‚ è¯´æ˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã€å‘˜å·¥ç®¡ç†ã€‘
employee:create      â”‚      âœ…     â”‚   âœ…    â”‚    âŒ    â”‚ åˆ›å»ºå‘˜å·¥
employee:read        â”‚      âœ…     â”‚   âœ…    â”‚    âœ…    â”‚ æŸ¥çœ‹å‘˜å·¥
employee:update      â”‚      âœ…     â”‚   âœ…    â”‚    âš ï¸    â”‚ ç¼–è¾‘å‘˜å·¥
employee:delete      â”‚      âœ…     â”‚   âœ…    â”‚    âŒ    â”‚ åˆ é™¤å‘˜å·¥
employee:export      â”‚      âœ…     â”‚   âœ…    â”‚    âŒ    â”‚ å¯¼å‡ºæ•°æ®

ã€ç”¨æˆ·ç®¡ç†ã€‘
user:create          â”‚      âœ…     â”‚   âŒ    â”‚    âŒ    â”‚ åˆ›å»ºç”¨æˆ·
user:read            â”‚      âœ…     â”‚   âŒ    â”‚    âŒ    â”‚ æŸ¥çœ‹ç”¨æˆ·
user:update          â”‚      âœ…     â”‚   âŒ    â”‚    âŒ    â”‚ ç¼–è¾‘ç”¨æˆ·
user:delete          â”‚      âœ…     â”‚   âŒ    â”‚    âŒ    â”‚ åˆ é™¤ç”¨æˆ·
user:assign_role     â”‚      âœ…     â”‚   âŒ    â”‚    âŒ    â”‚ åˆ†é…è§’è‰²

ã€æ—¥å¿—ç®¡ç†ã€‘
log:read             â”‚      âœ…     â”‚   âœ…    â”‚    âš ï¸    â”‚ æŸ¥çœ‹æ—¥å¿—
log:export           â”‚      âœ…     â”‚   âš ï¸    â”‚    âŒ    â”‚ å¯¼å‡ºæ—¥å¿—

ã€ç»Ÿè®¡åŠŸèƒ½ã€‘
stats:read           â”‚      âœ…     â”‚   âš ï¸    â”‚    âŒ    â”‚ æŸ¥çœ‹ç»Ÿè®¡

å›¾ä¾‹:
  âœ… = å®Œå…¨å…è®¸
  âš ï¸  = å—é™å…è®¸ (æœ‰æ•°æ®èŒƒå›´é™åˆ¶)
  âŒ = ç¦æ­¢


ç‰¹æ®Šè¯´æ˜:

1. employee:update (EMPLOYEE è§’è‰²)
   âš ï¸ åªèƒ½ä¿®æ”¹è‡ªå·±çš„ä¿¡æ¯ï¼Œä¸”ä¸åŒ…æ‹¬:
   - è–ªèµ„ (salary)
   - éƒ¨é—¨ (department)
   - èŒä½ (position)

2. employee:* (MANAGER è§’è‰²)
   âš ï¸ åªèƒ½æ“ä½œæœ¬éƒ¨é—¨çš„å‘˜å·¥æ•°æ®
   
3. log:read (EMPLOYEE è§’è‰²)
   âš ï¸ åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ“ä½œæ—¥å¿—
   
4. log:export (MANAGER è§’è‰²)
   âš ï¸ åªèƒ½å¯¼å‡ºæœ¬éƒ¨é—¨çš„æ—¥å¿—
   
5. stats:read (MANAGER è§’è‰²)
   âš ï¸ åªèƒ½æŸ¥çœ‹æœ¬éƒ¨é—¨çš„ç»Ÿè®¡æ•°æ®
```

### 7.2 æ•°æ®è®¿é—®èŒƒå›´çŸ©é˜µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®è®¿é—®èŒƒå›´å¯¹ç…§è¡¨                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

èµ„æºç±»å‹      â”‚ SUPER_ADMIN â”‚ MANAGER        â”‚ EMPLOYEE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å‘˜å·¥æ•°æ®      â”‚ å…¨éƒ¨        â”‚ æœ¬éƒ¨é—¨         â”‚ ä»…æœ¬äºº
æ“ä½œæ—¥å¿—      â”‚ å…¨éƒ¨        â”‚ æœ¬éƒ¨é—¨         â”‚ ä»…æœ¬äºº
ç»Ÿè®¡æ•°æ®      â”‚ å…¨å…¬å¸      â”‚ æœ¬éƒ¨é—¨         â”‚ âŒ
ç”¨æˆ·è´¦å·      â”‚ å…¨éƒ¨        â”‚ âŒ             â”‚ âŒ


ç¤ºä¾‹åœºæ™¯:

1. æŸ¥è¯¢å‘˜å·¥åˆ—è¡¨
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GET /api/employ?department=æŠ€æœ¯éƒ¨            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   SUPER_ADMIN:
     â†’ è¿”å›æ‰€æœ‰å‘˜å·¥ (å¿½ç•¥ department å‚æ•°)
   
   MANAGER (æŠ€æœ¯éƒ¨):
     â†’ è¿”å›æŠ€æœ¯éƒ¨å‘˜å·¥
     â†’ å¦‚æœå‚æ•°æ˜¯å…¶ä»–éƒ¨é—¨, è¿”å›ç©ºåˆ—è¡¨
   
   EMPLOYEE:
     â†’ åªè¿”å›è‡ªå·±çš„ä¿¡æ¯


2. æŸ¥çœ‹å‘˜å·¥è¯¦æƒ…
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GET /api/employ/5                            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   å‘˜å·¥5çš„éƒ¨é—¨: "æŠ€æœ¯éƒ¨"
   
   SUPER_ADMIN:
     â†’ âœ… å¯ä»¥æŸ¥çœ‹
   
   MANAGER (æŠ€æœ¯éƒ¨):
     â†’ âœ… å¯ä»¥æŸ¥çœ‹
   
   MANAGER (é”€å”®éƒ¨):
     â†’ âŒ 403 Forbidden
   
   EMPLOYEE (employeeId=5):
     â†’ âœ… å¯ä»¥æŸ¥çœ‹
   
   EMPLOYEE (employeeId=6):
     â†’ âŒ 403 Forbidden
```

### 7.3 æ“ä½œæƒé™å†³ç­–æ ‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ“ä½œæƒé™å†³ç­–æ ‘                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·å‘èµ·æ“ä½œ: åˆ é™¤å‘˜å·¥ (DELETE /api/employ/5)
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ ç”¨æˆ·æ˜¯å¦å·²ç™»å½•?       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ å¦                    â”‚ æ˜¯
        â–¼                       â–¼
    è¿”å› 401            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    "è¯·å…ˆç™»å½•"          â”‚ ç”¨æˆ·è§’è‰²æ˜¯ä»€ä¹ˆ?  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                    â”‚                    â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ SUPER_ADMIN   â”‚  â”‚    MANAGER     â”‚  â”‚   EMPLOYEE     â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                   â”‚                    â”‚
            â–¼                   â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æ‹¥æœ‰æ‰€æœ‰æƒé™  â”‚    â”‚ æœ‰åˆ é™¤æƒé™?  â”‚    â”‚ æœ‰åˆ é™¤æƒé™?  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                   â”‚                    â”‚
           â”‚ âœ…                â”‚ âœ…                 â”‚ âŒ
           â”‚                   â”‚                    â”‚
           â”‚                   â–¼                    â–¼
           â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      è¿”å› 403
           â”‚           â”‚ å‘˜å·¥æ˜¯æœ¬éƒ¨é—¨? â”‚      "æ— æƒé™"
           â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                   â”‚
           â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚       â”‚ æ˜¯                    â”‚ å¦
           â”‚       â–¼                       â–¼
           â”‚   âœ… å…è®¸              è¿”å› 403
           â”‚   æ‰§è¡Œåˆ é™¤             "åªèƒ½æ“ä½œæœ¬éƒ¨é—¨"
           â”‚       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ æ‰§è¡Œåˆ é™¤æ“ä½œ   â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ è®°å½•æ“ä½œæ—¥å¿—   â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                        è¿”å› 200
                        "åˆ é™¤æˆåŠŸ"
```

---

## 8. å­¦ä¹ è·¯å¾„å»ºè®®

### 8.1 ç†è§£é¡ºåº

```
1. å…ˆç†è§£æ ¸å¿ƒæ¦‚å¿µ
   â””â”€ RBAC æ¨¡å‹: ç”¨æˆ· â†’ è§’è‰² â†’ æƒé™

2. ç†è§£æ•°æ®åº“è®¾è®¡
   â””â”€ è¡¨ç»“æ„ + è¡¨å…³ç³»

3. ç†è§£åç«¯æµç¨‹
   â””â”€ è¿‡æ»¤å™¨ â†’ Controller â†’ åˆ‡é¢ â†’ Service â†’ Repository

4. ç†è§£å‰ç«¯æµç¨‹
   â””â”€ Store â†’ ç»„ä»¶ â†’ API â†’ è¯·æ±‚

5. ç†è§£å®Œæ•´è¯·æ±‚æµç¨‹
   â””â”€ å‰ç«¯ç‚¹å‡» â†’ åç«¯éªŒè¯ â†’ è¿”å›ç»“æœ

6. å®é™…ç¼–ç å®ç°
   â””â”€ æŒ‰ç…§å®ç°æ­¥éª¤ä¸€æ­¥æ­¥å®Œæˆ
```

### 8.2 é‡ç‚¹å…³æ³¨

```
ğŸ”‘ å…³é”®ç±»/ç»„ä»¶:
â”œâ”€ åç«¯
â”‚   â”œâ”€ @RequiresPermission æ³¨è§£   â—„â”€â”€ å£°æ˜æƒé™
â”‚   â”œâ”€ PermissionAspect          â—„â”€â”€ éªŒè¯æƒé™
â”‚   â”œâ”€ PermissionService         â—„â”€â”€ æƒé™é€»è¾‘
â”‚   â””â”€ SecurityUtil              â—„â”€â”€ è·å–å½“å‰ç”¨æˆ·
â”‚
â””â”€ å‰ç«¯
    â”œâ”€ permissionStore           â—„â”€â”€ æƒé™çŠ¶æ€
    â”œâ”€ PermissionGuard           â—„â”€â”€ æƒé™æ§åˆ¶
    â””â”€ request.ts                â—„â”€â”€ Token ä¼ é€’
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-02  
**å»ºè®®**: æ‰“å°æ­¤æ–‡æ¡£æˆ–åœ¨ç¬¬äºŒå±å¹•æ˜¾ç¤ºï¼Œè¾¹çœ‹è¾¹å®ç°
